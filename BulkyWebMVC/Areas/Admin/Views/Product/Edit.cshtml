@model Bulky.Models.Models.Product

<div class="container py-5">
    <div class="card shadow-lg rounded">
        <!-- Header -->
        <div class="card-header bg-primary text-white d-flex align-items-center">
            <i class="bi bi-pencil-square fs-3 me-3"></i>
            <h2 class="mb-0">Edit Product</h2>
        </div>

        <div class="card-body p-4">
            <form asp-action="Edit" method="post" enctype="multipart/form-data" novalidate>
                <!-- Hidden fields -->
                <input type="hidden" asp-for="Id" />
                <input type="hidden" asp-for="ImageUrl" />

                <div class="row g-4">
                    <!-- Left side -->
                    <div class="col-md-6">

                        <!-- Title -->
                        <div class="mb-3">
                            <label asp-for="Title" class="form-label fw-semibold">
                                <i class="bi bi-tag-fill me-2 text-primary"></i> Title
                            </label>
                            <input asp-for="Title" class="form-control form-control-lg" placeholder="Enter product title..." />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label asp-for="Description" class="form-label fw-semibold">
                                <i class="bi bi-card-text me-2 text-primary"></i> Description
                            </label>
                            <textarea asp-for="Description" rows="4" class="form-control" placeholder="Enter product description..."></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <!-- ISBN -->
                        <div class="mb-3">
                            <label asp-for="ISBN" class="form-label fw-semibold">
                                <i class="bi bi-upc-scan me-2 text-primary"></i> ISBN
                            </label>
                            <input asp-for="ISBN" class="form-control" placeholder="ISBN number..." />
                            <span asp-validation-for="ISBN" class="text-danger"></span>
                        </div>

                        <!-- Author -->
                        <div class="mb-3">
                            <label asp-for="Author" class="form-label fw-semibold">
                                <i class="bi bi-person-fill me-2 text-primary"></i> Author
                            </label>
                            <input asp-for="Author" class="form-control" placeholder="Author name..." />
                            <span asp-validation-for="Author" class="text-danger"></span>
                        </div>

                        <hr />

                        <!-- ListPrice -->
                        <div class="mb-3">
                            <label asp-for="ListPrice" class="form-label fw-semibold">
                                <i class="bi bi-cash-stack me-2 text-success"></i> List Price
                            </label>
                            <input asp-for="ListPrice" type="number" step="0.01" class="form-control" placeholder="List price..." />
                            <span asp-validation-for="ListPrice" class="text-danger"></span>
                        </div>

                        <!-- Price -->
                        <div class="mb-3">
                            <label asp-for="Price" class="form-label fw-semibold">
                                <i class="bi bi-currency-dollar me-2 text-success"></i> Price
                            </label>
                            <input asp-for="Price" type="number" step="0.01" class="form-control" placeholder="Price..." />
                            <span asp-validation-for="Price" class="text-danger"></span>
                        </div>

                        <!-- Price50 -->
                        <div class="mb-3">
                            <label asp-for="Price50" class="form-label fw-semibold">
                                <i class="bi bi-basket3-fill me-2 text-warning"></i> Price 50+
                            </label>
                            <input asp-for="Price50" type="number" step="0.01" class="form-control" placeholder="Price for 50+ items..." />
                            <span asp-validation-for="Price50" class="text-danger"></span>
                        </div>

                        <!-- Price100 -->
                        <div class="mb-3">
                            <label asp-for="Price100" class="form-label fw-semibold">
                                <i class="bi bi-basket-fill me-2 text-warning"></i> Price 100+
                            </label>
                            <input asp-for="Price100" type="number" step="0.01" class="form-control" placeholder="Price for 100+ items..." />
                            <span asp-validation-for="Price100" class="text-danger"></span>
                        </div>

                        <!-- Category Dropdown -->
                        <div class="mb-4">
                            <label asp-for="CategoryId" class="form-label fw-semibold">
                                <i class="bi bi-list-task me-2 text-info"></i> Category
                            </label>
                            <select asp-for="CategoryId" class="form-select form-select-lg border-primary shadow-sm" asp-items="ViewBag.ListOfCategory">
                                <option value="">-- Select Category --</option>
                            </select>
                            <span asp-validation-for="CategoryId" class="text-danger"></span>
                        </div>

                        <!-- Upload Image -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bi bi-image-fill me-2 text-info"></i> Upload Image
                            </label>
                            <input type="file" name="file" class="form-control" accept="image/*" id="imgInput" />
                            <small class="text-muted d-block mt-1" id="fileName">No file chosen</small>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="resetImg">
                                    <i class="bi bi-arrow-counterclockwise me-1"></i> Restore Old Image
                                </button>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex justify-content-end gap-3">
                            <button type="submit" class="btn btn-primary btn-lg shadow">
                                <i class="bi bi-save me-2"></i> Save Changes
                            </button>
                            <a asp-action="Index" class="btn btn-outline-secondary btn-lg shadow">
                                <i class="bi bi-arrow-left me-2"></i> Back to List
                            </a>
                        </div>
                    </div>

                    <!-- Right side: Image Preview -->
                    <div class="col-md-6">
                        <div class="card shadow-sm border-0 h-100">
                            <div class="card-body d-flex flex-column align-items-center justify-content-center">
                                <div class="position-relative w-100">
                                    <img id="imgPreview"
                                         data-original="@(string.IsNullOrEmpty(Model.ImageUrl) ? "" : Model.ImageUrl)"
                                         src="@(string.IsNullOrEmpty(Model.ImageUrl) ? "" : Model.ImageUrl)"
                                         alt="Product Image"
                                         class="img-fluid rounded border w-100"
                                         style="max-height: 500px; object-fit: cover;" />

                                    <span id="imgTag" class="badge bg-dark position-absolute top-0 start-0 m-2">
                                        @(string.IsNullOrEmpty(Model.ImageUrl) ? "No image" : "Current")
                                    </span>
                                </div>

                                @if (string.IsNullOrEmpty(Model.ImageUrl))
                                {
                                    <p class="text-muted mt-3 mb-0">No image uploaded</p>
                                }
                                else
                                {
                                    <p class="text-muted mt-3 mb-0">This is the current image. Selecting a new file will preview it here.</p>
                                }
                            </div>
                        </div>
                    </div>
                </div> <!-- /row -->
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        (function () {
            const input = document.getElementById("imgInput");
            const preview = document.getElementById("imgPreview");
            const tag = document.getElementById("imgTag");
            const fileName = document.getElementById("fileName");
            const resetBtn = document.getElementById("resetImg");
            const originalSrc = preview ? preview.getAttribute("data-original") : "";

            if (!input || !preview) return;

            input.addEventListener("change", function (event) {
                const file = event.target.files && event.target.files[0];
                if (!file) {
                    preview.src = originalSrc || "";
                    tag && (tag.textContent = originalSrc ? "Current" : "No image");
                    fileName && (fileName.textContent = "No file chosen");
                    return;
                }

                if (!file.type.startsWith("image/")) {
                    alert("Please select a valid image file.");
                    input.value = "";
                    return;
                }

                fileName && (fileName.textContent = file.name);

                const objectUrl = URL.createObjectURL(file);
                preview.src = objectUrl;
                tag && (tag.textContent = "Preview");
                preview.onload = () => URL.revokeObjectURL(objectUrl);
            });

            resetBtn?.addEventListener("click", function (e) {
                e.preventDefault();
                input.value = "";
                preview.src = originalSrc || "";
                tag && (tag.textContent = originalSrc ? "Current" : "No image");
                fileName && (fileName.textContent = "No file chosen");
            });
        })();
    </script>
}
